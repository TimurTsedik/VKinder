# VKinder

![img.png](img.png)

## Цель проекта

Разработать программу-бота, который выполняет следующие действия:

1. Используя информацию (возраст, пол, город) о пользователе, который общается с ботом в ВКонтакте, сделать поиск других
   пользователей ВКонтакте для знакомств.

- Реализовано

2. У тех людей, которые подошли под критерии поиска, получить три самые популярные фотографии в профиле. Популярность
   определяется по количеству лайков.

- Реализовано

3. Выводить в чат с ботом информацию о пользователе в формате:  
   а) имя и фамилия,  
   б) ссылка на профиль,  
   в) три фотографии в виде attachment(https://dev.vk.com/method/messages.send).

- Реализовано

4. Должна быть возможность перейти к следующему человеку с помощью команды или кнопки.

- Реализовано

5. Сохранить пользователя в список избранных.

- Реализовано

6. Вывести список избранных людей.

- Реализовано

Дополнительная задача:

1. Получать токен от пользователя с нужными правами.

- Не реализовано

2. Добавлять человека в чёрный список, чтобы он больше не попадался при поиске, используя БД.

- Реализовано

3. Создать кнопки в чате для взаимодействия с ботом.

- Реализовано

4. Добавить возможность ставить/убирать лайк выбранной фотографии.

- Не реализовано

5. К списку фотографий из аватарок добавлять список фотографий, где отмечен пользователь.

- Не реализовано

6. В ВКонтакте максимальная выдача при поиске — 1 000 человек. Подумайте, как это ограничение можно обойти.

- Не реализовано

7. Можно усложнить поиск, добавив поиск по интересам. Разбор похожих интересов — группы, книги, музыка — нужно будет
   провести с помощью анализа текста.

- Частично реализовано

8. У каждого критерия поиска должны быть свои веса, то есть совпадение по возрасту должно быть важнее общих групп,
   интересы по музыке — важнее книг, наличие общих друзей — важнее возраста и т. д.

- Не реализовано

## Порядок работы с ботом

Перед началом работы необходимо в файл [config.ini](config.ini) добавить в соответствующие поля: групповой токен для ВК,
личный токен для ВК, имя базы данных, имя пользователя базы данных, пароль базы данных

1. Начало работы - кнопка или команда "привет"
2. При входе в чат-бот данные пользователя добавляются в талицу Users. Пользователь имеет возможность выбрать 3 режима
   работы - поиск, работа со списком избранных, работа с черным списком.
3. В случае, если пользователь в своем профиле не указал свои данные, ему будет выдаваться сообщение: "Для поиска
   необходимо указать в своем профиле город, пол и возраст"
4. При выборе режима работы "Поиск":

- в соответствии с параметрами пользователя создается запрос на поиск кандидатов противоположного пола, в том же городе
  и в возрасте +-3 года.
- Пользователю выдается сообщение о количестве найденных результатов и появляется кнопка "Следующий в поиске".
- Учитывается черный список пользователя и кандидаты из этого списка исключаются из выдачи.
- Выдается имя, фамилия, возраст, ссылка на профиль и до 3 самых популярных фотографий, если они есть.
- С отображенным на экране кандидатом возможны следующие действия - отправить в избранное, отправить в черный список.
- Когда исчерпается список выборки, пользователь переходит в начало.

5. При выборе режима работы со списками избранных/черным списком

- Имеется возможность просмотреть весь список
- Имеется возможность перенести из одного списка в другой
- Имеется возможность удалить пользователя из списка.
- Когда список кандидатов опустеет, выдается сообщение, что список пуст и пользователь переходит в начало.

6. Окончание работы - кнопка или команда "пока"

## Реализация проекта

Проект реализован в виде 3 блоков - основная программа (запуск), пакет работы с базой данных DB, пакет работы с
чат-ботом VK
Пакет работы с БД состоит из двух модулей - моделью БД и менеджером БД. БД реализована в виде экземпляра класса
ManageDB, созданного с помощью ORM sqlalchemy. Состоит из 3 таблиц: Users (хранение информации о всех пользователях и
кандидатах), Favorite и BlackList для хранения соответствующих списков для каждого пользователя.  
Схема БД представлена на рисунке
![db.png](DB%2Fdb.png)
Пакет чат-бота состоит из модулей самого бота, модуля с функциями API VK и модуля с классом хранилища данных
пользователей.
Модуль чат-бота реализует класс VkBot, отвечающий за логику работы чат-бота, обмен данными с БД и API VK.
В модуль функций API VK вынесены служебные функции необходимые для взаимодействия с API VK чат-бота, как то функция
кнопок, функции получения и сортировки фотографий и др.  
Модуль с классом UserResultsStorage реализует организованное многопользовательское хранилище данных пользователей и
кандидатов в оперативной памяти



